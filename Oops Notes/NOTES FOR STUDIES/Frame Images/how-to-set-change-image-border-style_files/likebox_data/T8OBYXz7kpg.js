/*1343020954,169776065*/

if (window.CavalryLogger) { CavalryLogger.start_js(["dYAr7"]); }

__d("StarsRatable",["event-extensions","AsyncRequest","CSS","DOM","Parent","Run","URI","copyProperties","ge"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('Parent'),k=b('Run'),l=b('URI'),m=b('copyProperties'),m=b('copyProperties'),n=b('ge');function o(p,q,r,s,t,u){this.rootID=p;this.href=q;this.appID=r;this.source=s;this.listeners=[];this.doSubmit=u;if(t)this.start();k.onLeave(this.destroyListeners.bind(this));o._instances[this.rootID]=this;}o._instances={};o.start=function(p){o._instances[p].start();};m(o.prototype,{start:function(){this.root=n(this.rootID);this.stars=i.scry(this.root,'i');this.listeners=[Event.listen(this.root,'click',this._onClick.bind(this)),Event.listen(this.root,'mouseover',this._onMouseOver.bind(this)),Event.listen(this.root,'mouseout',this.setRating.bind(this,0))];},_onClick:function(event){this.destroyListeners();h.addClass(this.root,'uiStarsRated');var p=j.byTag(event.getTarget(),'i');if(p){var q=this.stars.indexOf(p);if(q>=0){this.isRated=true;var r={rating:q+1,app_id:this.appID,source:this.source};this.setRating(q+1,true);if(!this.doSubmit)return true;new g().setURI(new l(this.href)).setData(r).send();}}return false;},_onMouseOver:function(event){var p=j.byTag(event.getTarget(),'i');if(p){var q=this.stars.indexOf(p);if(q>=0)this.setRating(q+1,false);}},setRating:function(p,q){var r=q?'fullStar':'hoverStar',s=q?'hoverStar':'emptyStar';for(var t=0;t<this.stars.length;++t)if(t<p){h.removeClass(this.stars[t],s);h.addClass(this.stars[t],r);}else{h.removeClass(this.stars[t],'hoverStar');h.addClass(this.stars[t],'emptyStar');}},destroyListeners:function(){this.listeners.forEach(function(p){p&&p.remove();});}});a.StarsRatable=e.exports=o;});
__d("legacy:intl-locale",["Locale"],function(a,b,c,d){a.intl_locale_is_rtl=b('Locale').isRTL;},3);
__d("legacy:string-escape",["StringEscape"],function(a,b,c,d){var e=b('StringEscape');a.escape_js_quotes=e.escapeJSQuotes;a.htmlspecialchars=e.htmlSpecialChars;a.htmlize=e.htmlize;},3);
__d("isEmail",[],function(a,b,c,d,e,f){function g(h){return (/^([\w!.%+\-])+@([\w\-])+(?:\.[\w\-]+)+$/).test(h);}e.exports=g;});
__d("legacy:string-misc",["htmlHyperlink","isEmail"],function(a,b,c,d){a.html_hyperlink=b('htmlHyperlink');a.is_email=b('isEmail');},3);
var ReviewsApp={writeReview:false,writeReviewElem:null,ON_RATING_SET:'reviews/on_rating_set',ON_REVIEW_SUBMITTED:'reviews/on_review_submitted',IMAGE_STAR_ON:null,IMAGE_STAR_OFF:null,initialize:function(a,b){ReviewsApp.IMAGE_STAR_ON=a;ReviewsApp.IMAGE_STAR_OFF=b;var c=[a,b];for(var d=0;d<c.length;d++)(new Image()).src=c[d];}};function reviews_show_editor_inline(a){hide('review_editor_status');toggle(ge('reviews_inline_editor'));ReviewsApp.writeReviewElem=a;}function reviews_jump_to_and_open_editor(){var a=ge('reviews_inline_editor');if(a){show(a);$('review_blurb').focus();DOMScroll.scrollTo(a,true,true);}}function reviews_set_rating(a){var b=ge('review_rating');b.value=a;for(var c=1;c<=5;c++){var d=$('review_rating_star'+c).getElementsByTagName('img')[0];if(c<=a){d.src=ReviewsApp.IMAGE_STAR_ON;}else d.src=ReviewsApp.IMAGE_STAR_OFF;}Arbiter.inform(ReviewsApp.ON_RATING_SET,{element:b});return false;}function reviews_hover_rating(a){var b=ge('review_rating');if(!(b.value>0)){for(var c=1;c<=5;c++){var d=$('review_rating_star'+c).getElementsByTagName('img')[0];if(c<=a){d.src=ReviewsApp.IMAGE_STAR_ON;}else d.src=ReviewsApp.IMAGE_STAR_OFF;}}else return false;}function reviews_submit(a,b,c,d){if(c){new Dialog().setTitle(c).setBody(d).setModal(true).setButtons([Dialog.CLOSE]).show();return false;}var e=ge('review_blurb'),f=ge('review_rating'),g=Input.getValue(e),h=f.value,b=$('review_id').value;e.disabled=true;var i=(h<1)||(h>5);if(i){var j="You must choose a star rating",k=$('review_editor_error');DOM.setContent(k,HTML(j));show(k);e.disabled=false;return false;}else{var l=function(m){var n="Post successful.",o=$('review_editor_status');DOM.setContent(o,HTML(n));if(b>0){var p=ge('review_'+b);p.parentNode.removeChild(p);}var q=ge('new_review_container'),r=m.getPayload();if(r.reload)window.location.reload();if(r.oid)$('review_id').value=parseInt(r.oid);DOM.setContent(q,HTML(r.markup));show(o);setTimeout(function(){hide(o);},3000);hide('review_editor_error');hide('reviews_inline_editor');if(ReviewsApp.writeReview){if(ReviewsApp.writeReviewElem)DOM.setContent(ReviewsApp.writeReviewElem,HTML("Update Review"));ReviewsApp.writeReview=false;}};new AsyncRequest().setURI('/ajax/applications/reviews/inline/editor.php?of='+a).setData({review_id:b,rating:h,blurb:g}).setHandler(l).send();e.disabled=false;return true;}}
var EditAppSettings={currentTab:undefined,callbackUrl:'/ajax/edit_app_settings.php',statusElement:'edit_app_settings_save_fill',profileHandler:bagofholding,extendedHandler:bagofholding,appID:0,setup:function(a,b,c){this.appID=a;this.profileID=b;this.currentTab=c;return this;},_getCurrentTab:function(){if(!this.currentTab){var a=['profile','bookmark','extended'];for(var b=0;b<a.length;b++)if(ge(this._getTabId(a[b]))){this.currentTab=a[b];break;}}return this.currentTab;},_getTabId:function(a){return a+'_tab_link';},setupHandlers:function(a){this.profileHandler=a.profile||bagofholding;this.extendedHandler=a.extended||bagofholding;},switchTab:function(a){CSS.removeClass(this._getTabId(this._getCurrentTab()),'tab_link_selected');hide('app_settings_'+this._getCurrentTab()+'_tab');CSS.addClass(this._getTabId(a),'tab_link_selected');show('app_settings_'+a+'_tab');this.currentTab=a;},isUiMode:function(){return Dialog.getCurrent();},setExtendedPermission:function(a,b){var c=ge('explanation_'+a);if(c)(b?hide:show)(c);var d=new AsyncRequest().setURI(this.callbackUrl).setHandler(this.extendedHandler.bind(this,this.appID,a)).setData({extended:1,permission:a,allow:b,profile_id:this.profileID,app_id:this.appID});if(this.isUiMode())d.setStatusElement(this.statusElement);d.send();return true;},makeProfileChange:function(a){var b=new AsyncRequest().setURI(this.callbackUrl).setHandler(this.profileHandler.bind(this,this.appID)).setData({profile:1,item:'tab',action:a,app_id:this.appID,profile_id:this.profileID});if(this.isUiMode())b.setStatusElement(this.statusElement);b.send();if(this.isUiMode()){toggleDisplayNone('app_settings_profile_tab_add');toggleDisplayNone('app_settings_profile_tab_remove');CSS.toggleClass($('profile_tab_name_changer'),'hidden_elem');}},removeApplication:function(a){var b=a||bagofholding,c={remove:1,app_id:this.appID,profile_id:this.profileID};new AsyncRequest().setURI(this.callbackUrl).setHandler(b).setData(c).send();},blockApplication:function(a){var b=a||bagofholding;new AsyncRequest().setURI(this.callbackUrl).setHandler(b).setData({block:1,app_id:this.appID,profile_id:this.profileID}).send();},setBlockComposer:function(a,b){new AsyncRequest().setURI(this.callbackUrl).setHandler(b||bagofholding).setData({composer:1,blocked_composer:a,profile_id:this.profileID,app_id:this.appID}).send();},reviveComposerDialog:function(a,b){var c=tx._("Unblock {app-name} Publisher?",{'app-name':htmlize(a)}),d='<p>'+"Are you sure you want to allow this application's publisher on your profile? "+'</p>',e="Unblock";new Dialog().setTitle(c).setBody(d).setButtons([{name:'remove',label:e},Dialog.CANCEL]).setHandler(this.setBlockComposer.bind(this,0,b)).show();}};
function chain(a,b){var c,d=[];for(var e=0;e<arguments.length;e++)d.push(arguments[e]);c=function(event){event=event||window.event;for(var f=0;f<d.length;f++)if(d[f]&&d[f].apply(this,arguments)===false){return false;}else if(event&&event.cancelBubble)return true;return true;};c.toString=function(){return chain._toString(d);};return c;}if(!chain._toString)chain._toString=function(a){var b='chained fns';for(var c=0;c<a.length;c++)b+='\n'+a[c].toString();return b;};
function dropmenu(a){if(this==window){return new dropmenu(a);}else{this.className=null;this.menu=null;this.menuClickArea=null;this.showHandler=null;this.hideHandler=null;this.alignment=null;this.direction=null;this.isShown=false;this.canHide=false;this.show_hooks=[];this.hide_hooks=[];this.clickTarget=$(a);this.displayTarget=$(a);this.id=null;this.rtl=false;this._clickToHide=true;this._markupContentCallback=bagofholding;this.clickHandle=Event.listen(this.clickTarget,'click',this.toggle.bind(this));this.container=ge('dropmenu_container')||this.createContainer();return this;}}dropmenu.ALIGN_RIGHT=1;dropmenu.ALIGN_LEFT=2;dropmenu.DIRECTION_UP=3;dropmenu.DIRECTION_DOWN=4;dropmenu.INSTANCES={};dropmenu.prototype.createContainer=function(){var a=DOM.create('div',{id:'dropmenu_container'});DOM.appendContent(document.body,a);return a;};dropmenu.prototype.setPosition=function(a){this.alignment=a;return this;};dropmenu.prototype.setDirection=function(a){this.direction=a;return this;};dropmenu.prototype.setMenuClickArea=function(a){this.menuClickArea=$(a);return this;};dropmenu.prototype.setDisplayTarget=function(a){this.displayTarget=$(a);return this;};dropmenu.prototype.setClickToHide=function(a){this._clickToHide=a;return this;};dropmenu.prototype.setMarkupContent=function(a,b,c){this.menuContent=c;this.className=b;this.id=a;return this;};dropmenu.prototype.setMarkupContentCallback=function(a){this._markupContentCallback=a;return this;};dropmenu.prototype._getMarkupContent=function(){return this.menuContent||this._markupContentCallback();};dropmenu.prototype.registerHTMLMenu=function(a){this.registered_menu_id=a;return this;};dropmenu.prototype.addHook=function(a,b){this[a+'_hooks'].push(b);return this;};dropmenu.prototype.removeHook=function(a,b){for(var c=0;c<this[a+'_hooks'].length;c++)if(b==this[a+'_hooks'][c]){this[a+'_hooks'].splice(c,1);return true;}return this;};dropmenu.prototype.toggle=function(a){if(!this.isShown){this._show();this.canHide=false;}else this._hide();$E(a).prevent();};dropmenu.prototype.show=function(){this._show();};dropmenu.prototype.hide=function(){if(!this.menu)return;this._hide();};dropmenu.prototype.destroy=function(){if(this.menu&&this.menu.parentNode){this.menu.parentNode.removeChild(this.menu);this.menu=null;}};dropmenu.prototype._buildMenu=function(){if(intl_locale_is_rtl()&&!this.rtl){this.alignment=(this.alignment==dropmenu.ALIGN_RIGHT)?dropmenu.ALIGN_LEFT:dropmenu.ALIGN_RIGHT;this.rtl=true;}if(this.registered_menu_id){this.menu=$(this.registered_menu_id);if(this.alignment||this.direction)this.container.appendChild(this.menu);}else this._buildDynamicMenu();dropmenu.INSTANCES[this.id]=this;this.menuClickArea=this.menuClickArea||DOM.scry(this.menu,'div.menu_content');this.menuClickArea.onclick=chain(this.menuClickArea.onclick,Event.stop);var a=DOM.scry(this.menu,'a');for(var b=0;b<a.length;b++)Event.listen(a[b],'click',function(){if(this._clickToHide)this._hide();}.bind(this));};dropmenu.prototype._buildDynamicMenu=function(){this.menu=document.createElement('div');this.menu.className='dropdown_menu hidden_elem '+(this.className?' '+this.className:'');this.menu.id='dropdown_menu_'+this.id;var a=this._getMarkupContent();if(!is_scalar(a)){DOM.setContent(this.menu,a);}else DOM.setContent(this.menu,HTML(a));this.container.appendChild(this.menu);};dropmenu.prototype._positionMenu=function(){if(this.alignment||this.direction||(!this.alignment&&!this.direction&&!this.registered_menu_id)){if(this.menu.parentNode!=this.container)this.container.appendChild(this.menu);var a=Vector2.getElementPosition(this.displayTarget,'document'),b=Vector2.getElementPosition(this.container,'document'),c=a.x-b.x,d=a.y-b.y+this.displayTarget.offsetHeight;if(this.alignment==dropmenu.ALIGN_RIGHT||this.direction==dropmenu.DIRECTION_UP){CSS.show(this.menu);this.menu.style.left='-9999px';this.menu.style.top='-9999px';if(this.alignment==dropmenu.ALIGN_RIGHT){var e=this.menu.offsetWidth;c=c+this.displayTarget.offsetWidth-e;}if(this.direction==dropmenu.DIRECTION_UP){var f=this.menu.offsetHeight;d=d-this.displayTarget.offsetHeight-f+1;}CSS.hide(this.menu);}this.menu.style.left=c+'px';this.menu.style.top=d+'px';}};dropmenu.prototype._onclick=function(event){this._hide();return false;};dropmenu.prototype._show=function(){if(!this.menu)this._buildMenu();this._positionMenu();CSS.show(this.menu);var a=this._documentHideHandler.bind(this);this.click_event=Event.listen(document.body,'click',a);onbeforeunloadRegister(a);this.isShown=true;for(var b=0;b<this.show_hooks.length;b++)this.show_hooks[b]();};dropmenu.prototype._documentHideHandler=function(a){if(!this.canHide){this.canHide=true;}else this._hide();};dropmenu.prototype._hide=function(){if(this.menu)CSS.hide(this.menu);if(this.click_event)this.click_event.remove();this.click_event=null;this.isShown=false;for(var a=0;a<this.hide_hooks.length;a++)this.hide_hooks[a]();if(!this.registered_menu_id)this.destroy();};dropmenu.prototype._build_menu_shim=function(){this.shim=null;if(ua.ie()<7){this.shim=document.createElement('iframe');CSS.setClass(shim,'iframe_shim');this.container.appendChild(this.shim);}};dropmenu.getExistingInstance=function(a){return dropmenu.INSTANCES[a];};
var EditAppsController={BOOKMARKS_VIEW:'bookmarks',currentView:'',sortableGroup:null,ownedApps:null,init:function(a,b){this.profileID=a;this.ownedApps=b;EditAppSettings.setupHandlers({profile:this.changeProfileCallback,extended:this.setExtendedPermissionCallback});},setView:function(a){this.currentView=a;},switchView:function(a){goURI(new URI('/editapps.php').addQueryData({v:a}).toString());},changeProfileCallback:function(a){if(ge('editapps_tab_'+a)){toggleDisplayNone('editapps_tab_'+a);toggleDisplayNone('editapps_tab_'+a+'_undo');}},removeAppSuccessDialog:function(a,b,c){var d="Application Removed",e=tx._("You have removed \"{application-name}\".",{'application-name':b});new Dialog().setTitle(d).setBody(e).setButtons([Dialog.OK]).setHandler(a.bind(this,c)).show();},removeApplication:function(a,b,c){var d=htmlize(b),e=tx._("Remove {application-name}?",{'application-name':d}),f='<a href="/?sk=apps">'+"Apps Page"+'</a>',g='<p>'+tx._("If you remove {application-name}, it will be taken off your timeline, bookmarks and from the list of apps you use in your settings. You can also block apps to prevent them from accessing the non-public information you share with others who use them.",{'application-name':d,'applications-link':f})+'</p>';g+='<input type="hidden" name="remove_appId" value="'+a+'" />';var h={name:'remove',label:"Remove"},i=[h,Dialog.CANCEL];g='<div class="remove_application_dialog">'+g+'</div>';new Dialog().setTitle(e).setBody(g).setButtons(i).setModal(true).setHandler(function(){EditAppSettings.setup(a,this.profileID).removeApplication(c);}).show();return false;},removeExtendedPermission:function(a,b){this.setExtendedPermission(a,b,false);},undoRemoveExtendedPermission:function(a,b){this.setExtendedPermission(a,b,true);},setExtendedPermission:function(a,b,c){EditAppSettings.setup(a,this.profileID).setExtendedPermission(b,c);return true;},setExtendedPermissionCallback:function(a,b){toggleDisplayNone('editapps_extperm_'+b+'_'+a);toggleDisplayNone('editapps_extperm_'+b+'_'+a+'_undo');},addSortable:function(a){var b=$('editapps_bookmarked_wrapper_'+a);this.sortableGroup.addSortable(a,b);}};
function MegaphoneEmailStoriesHelper(){}copyProperties(MegaphoneEmailStoriesHelper,{_endpoint_uri:'/ajax/emails/email_stories.php',submitEmail:function(a,b){form=document.forms[a];if(form&&!this.pending_request){email=form.elements[b];if(email&&email.value!=''&&is_email(email.value)){this.pending_request=true;this._ajaxSubmitForm(a,{divid:a});}}return false;},resendEmail:function(a,b,c){if(a!=''&&b!=''){form=document.forms[a];if(form&&!this.pending_request){if(form.elements.newemail)form.elements.newemail.value='';this.pending_request=true;this._ajaxSubmitForm(a,{resend:1,divid:a});}}return false;},cancelEmail:function(a,b){if(a!=''&&b!=''){form=document.forms[a];if(form){if(form.elements.newemail)form.elements.newemail.value='';this._ajaxSubmitForm(a,{cancel:1,divid:a});}}return false;},_ajaxSubmitForm:function(a,b){var c=Form.serialize(document.forms[a]);copyProperties(c,b);new AsyncRequest().setURI(this._endpoint_uri).setData(c).setHandler(function(d){var e=d.getPayload();if(document.forms[a].modal&&document.forms[a].modal.value==1)Dialog.hideCurrent();if(e.show_msg)new Dialog().setTitle(e.title).setBody(e.msg).setButtons([Dialog.OK]).show();}).setFinallyHandler(bind(this,function(d){this.pending_request=false;var e=d.getPayload();if(e.redirect)goURI(e.redirect_uri);if(e.hide_mp){hide(a);}else if(e.replace_mp){var f=DOM.find($('pagelet_megaphone'),'div.UIContentBox');if(e.success){CSS.addClass(f,'megaphone_story_highlighted');}else CSS.removeClass(f,'megaphone_story_highlighted');DOM.setContent($('DarkMergeRoosterHeader'),HTML(e.new_header));DOM.setContent($('DarkMergeRoosterBody'),HTML(e.new_body));}})).send();}});